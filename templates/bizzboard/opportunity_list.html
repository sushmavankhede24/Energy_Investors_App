{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Job Board</h1>

    <!-- Search Form -->
    <form method="get" class="mb-4">
        <div class="input-group">
            <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="Search opportunities...">
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
    </form>

    <div class="row">
        <!-- Job List Sidebar -->
        <div class="col-md-4 border-end" style="max-height: 80vh; overflow-y: auto;">
            <ul class="list-group">
                {% for o in opportunities %}
                    <li class="list-group-item job-item" data-title="{{ o.fields.title }}" 
                        data-company="{{ o.fields.company|default:'Unknown Company' }}" 
                        data-description="{{ o.fields.description|default:'No description available' }}" 
                        data-location="{{ o.fields.location|default:'No location' }}" 
                        data-type="{{ o.fields.type }}" 
                        data-expired="{{ o.fields.expired_at|default:'N/A' }}">
                        <h6 class="mb-1">{{ o.fields.title }}</h6>
                        <small class="text-muted">
                            {% if o.fields.company %}{{ o.fields.company }}{% else %}Unknown Company{% endif %}
                        </small>
                        <p class="mb-0 text-truncate">
                            {% if o.fields.description %}{{ o.fields.description|truncatechars:50 }}{% else %}No description{% endif %}
                        </p>
                    </li>
                {% empty %}
                    <li class="list-group-item">No opportunities found.</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Job Details Pane -->
        <div class="col-md-8" id="job-details">
            <div class="p-3">
                <h3>Select a job to view details</h3>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const jobItems = document.querySelectorAll(".job-item");
    const jobDetails = document.getElementById("job-details");

    jobItems.forEach(item => {
        item.addEventListener("click", function() {
            const title = this.dataset.title;
            const company = this.dataset.company;
            const description = this.dataset.description;
            const location = this.dataset.location;
            const type = this.dataset.type;
            const expired = this.dataset.expired;

            jobDetails.innerHTML = `
                <div class="p-3">
                    <h2>${title}</h2>
                    <h5 class="text-muted">${company}</h5>
                    <p>${description}</p>
                    <span class="badge bg-primary">${type}</span>
                    <span class="badge bg-secondary">${location}</span>
                    <p class="mt-3"><small class="text-muted">Expires: ${expired}</small></p>
                </div>
            `;
        });
    });

    // Auto-select first job
    if (jobItems.length > 0) {
        jobItems[0].click();
    }
});
</script>
{% endblock %}
